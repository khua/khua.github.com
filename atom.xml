<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[TOPI.CO]]></title>
  <link href="http://khua.github.com/atom.xml" rel="self"/>
  <link href="http://khua.github.com/"/>
  <updated>2012-09-09T14:59:09+08:00</updated>
  <id>http://khua.github.com/</id>
  <author>
    <name><![CDATA[Kevin Hua]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[安装Redis，并设置自动启动]]></title>
    <link href="http://khua.github.com/blog/2012/09/09/an-zhuang-redis%2Cbing-she-zhi-zi-dong-qi-dong/"/>
    <updated>2012-09-09T14:45:00+08:00</updated>
    <id>http://khua.github.com/blog/2012/09/09/an-zhuang-redis,bing-she-zhi-zi-dong-qi-dong</id>
    <content type="html"><![CDATA[<h3>安装Redis</h3>

<h4>(1) 下载Redis</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://redis.googlecode.com/files/redis-2.2.11.tar.gz
</span><span class='line'>tar xzvf redis-2.2.11.tar.gz</span></code></pre></td></tr></table></div></figure>


<h4>(2) 编译并安装Redis</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make && make install</span></code></pre></td></tr></table></div></figure>


<h4>(3) 复制并修改配置文件</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp redis.conf /etc/redis.conf
</span><span class='line'>vi /etc/redis.conf</span></code></pre></td></tr></table></div></figure>


<p>注意修改以下几项：</p>

<!--more-->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>daemonize yes
</span><span class='line'>loglevel warning
</span><span class='line'>logfile /var/log/redis.log
</span><span class='line'>maxmemory 2GB</span></code></pre></td></tr></table></div></figure>


<p>(自行斟酌是不要开通Virtual Memory选项)</p>

<h4>(4) 设置Redis-Server自动启动服务</h4>

<p>上网下载启动脚本(<code>gist.github.com</code>，搜索<code>redis init.d</code>)，并简单修改</p>

<p>(至少需要修改<code>redis</code>、<code>REDIS_CONF_FILE</code>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vi /etc/init.d/redisctl
</span><span class='line'>chmod 755 redisctl
</span><span class='line'>cp /etc/init.d/redisctl /etc/rc.d/init.d/redisctl \
</span><span class='line'>&& ln -s /etc/init.d/redisctl /etc/rc.d/rc2.d/S90redisctl && ln -s /etc/init.d/redisctl /etc/rc.d/rc3.d/S90redisctl \
</span><span class='line'>&& ln -s /etc/init.d/redisctl /etc/rc.d/rc4.d/S90redisctl && ln -s /etc/init.d/mongod /etc/rc.d/rc5.d/S90redisctl
</span><span class='line'>chkconfig --add redisctl</span></code></pre></td></tr></table></div></figure>


<p>(5) 重新启动后可以测试redis-server是否正常启动</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redis-cli set foo Bar
</span><span class='line'>redis-cli get foo</span></code></pre></td></tr></table></div></figure>


<h3>Redis自动启动脚本 (CentOS 5.6适用)</h3>

<div><script src='https://gist.github.com/3683015.js?file='></script>
<noscript><pre><code>#!/bin/sh
#
# redis - this script starts and stops the redis-server daemon
#
# chkconfig:   2345 90 10 
# description:  Redis is a persistent key-value database
# processname: redis-server
# config:      /etc/redis.conf
# config:      /etc/sysconfig/redis
# pidfile:     /var/run/redis.pid

# Source function library.
. /etc/rc.d/init.d/functions

# Source networking configuration.
. /etc/sysconfig/network

# Check that networking is up.
[ &quot;$NETWORKING&quot; = &quot;no&quot; ] &amp;&amp; exit 0

redis=&quot;/usr/local/bin/redis-server&quot;
prog=$(basename $redis)

REDIS_CONF_FILE=&quot;/etc/redis.conf&quot;

[ -f /etc/sysconfig/redis ] &amp;&amp; . /etc/sysconfig/redis

lockfile=/var/lock/subsys/redis

start() {
    [ -x $redis ] || exit 5
    [ -f $REDIS_CONF_FILE ] || exit 6
    echo -n $&quot;Starting $prog: &quot;
    daemon $redis $REDIS_CONF_FILE
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; touch $lockfile
    return $retval
}

stop() {
    echo -n $&quot;Stopping $prog: &quot;
    killproc $prog -QUIT
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}

restart() {
    stop
    start
}

reload() {
    echo -n $&quot;Reloading $prog: &quot;
    killproc $redis -HUP
    RETVAL=$?
    echo
}

force_reload() {
    restart
}

rh_status() {
    status $prog
}

rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

case &quot;$1&quot; in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}

restart() {
    stop
    start
}

reload() {
    echo -n $&quot;Reloading $prog: &quot;
    killproc $redis -HUP
    RETVAL=$?
    echo
}

force_reload() {
    restart
}

rh_status() {
    status $prog
}

rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

case &quot;$1&quot; in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}

restart() {
    stop
    start
}

reload() {
    echo -n $&quot;Reloading $prog: &quot;
    killproc $redis -HUP
    RETVAL=$?
    echo
}

force_reload() {
    restart
}

rh_status() {
    status $prog
}

rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

case &quot;$1&quot; in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
        ;;
    reload)
        rh_status_q || exit 7
        $1
        ;;
    force-reload)
        force_reload
        ;;
    status)
        rh_status
        ;;
    condrestart|try-restart)
        rh_status_q || exit 0
            ;;
    *)
        echo $&quot;Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload}&quot;
        exit 2
esac</code></pre></noscript></div>


<h3>Redis自动启动脚本 (Ubuntu 10.04适用)</h3>

<p>记得修改：</p>

<p>(1) <code>—chuid group:user</code></p>

<p>(2) <code>ln /etc/init.d/redisctl /etc/rc2.d/redisctl，重复rc3，rc4，rc5</code></p>

<p>启动脚本：</p>

<div><script src='https://gist.github.com/3683021.js?file='></script>
<noscript><pre><code>#! /bin/sh
### BEGIN INIT INFO
# Provides:             redis-server
# Required-Start:       $syslog
# Required-Stop:        $syslog
# Should-Start:         $local_fs
# Should-Stop:          $local_fs
# Default-Start:        2 3 4 5
# Default-Stop:         0 1 6
# Short-Description:    redis-server - Persistent key-value db
# Description:          redis-server - Persistent key-value db
### END INIT INFO

DAEMON=/usr/local/bin/redis-server
DAEMON_ARGS=/etc/redis.conf
NAME=redis-server
DESC=redis-server
PIDFILE=/var/run/redis.pid
test -x $DAEMON || exit 0
test -x $DAEMONBOOTSTRAP || exit 0
set -e
case &quot;$1&quot; in
  start)
        echo -n &quot;Starting $DESC: &quot;
        touch $PIDFILE
        # chown redis:redis $PIDFILE
        if start-stop-daemon —start —quiet —umask 007 —pidfile $PIDFILE —chuid redis:redis —exec $DAEMON — $DAEMON_ARGS
        then
                echo &quot;$NAME.&quot;
        else
                echo &quot;failed&quot;
        fi
        ;;
  stop)
        echo -n &quot;Stopping $DESC: &quot;
        if start-stop-daemon —stop —retry 10 —quiet —oknodo —pidfile $PIDFILE —exec $DAEMON
        then
                echo &quot;$NAME.&quot;
        else
                echo &quot;failed&quot;
        fi
        rm -f $PIDFILE
        ;;
  restart|force-reload)
        ${0} stop
        ${0} start
        ;;
  *)
        echo &quot;Usage: /etc/init.d/$NAME {start|stop|restart|force-reload}&quot; &gt;&amp;2
        exit 1
        ;;
esac
exit 0</code></pre></noscript></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[安装mongodb，并设置自动启动]]></title>
    <link href="http://khua.github.com/blog/2012/09/09/an-zhuang-mongodb%2Cbing-she-zhi-zi-dong-qi-dong/"/>
    <updated>2012-09-09T14:08:00+08:00</updated>
    <id>http://khua.github.com/blog/2012/09/09/an-zhuang-mongodb,bing-she-zhi-zi-dong-qi-dong</id>
    <content type="html"><![CDATA[<h3>Ubuntu环境下安装</h3>

<p>Ubuntu环境下比较容易安装，可参考：</p>

<p><a href="http://www.mongodb.org/display/DOCS/Ubuntu+and+Debian+packages">Ubuntu and Debian packages</a></p>

<p>安装好后会自动配置。</p>

<h3>CentOS环境下安装</h3>

<h4>安装MongoDB</h4>

<h5>(1) 查看系统位数</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">getconf</span> <span class="no">LONG_BIT</span>
</span></code></pre></td></tr></table></div></figure>


<h5>(2) 编辑MongoDB的安装源</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vi</span> <span class="sr">/etc/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="mi">10</span><span class="n">gen</span><span class="o">.</span><span class="n">repo</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<h5>(3) 粘贴以下内容</h5>

<p><strong>64位适用：</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">10</span><span class="n">gen</span><span class="o">]</span>
</span><span class='line'><span class="nb">name</span><span class="o">=</span><span class="mi">10</span><span class="n">gen</span> <span class="no">Repository</span>
</span><span class='line'><span class="n">baseurl</span><span class="o">=</span><span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">downloads</span><span class="o">-</span><span class="n">distro</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">redhat</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="n">x86_64</span>
</span><span class='line'><span class="n">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>32位适用：</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">10</span><span class="n">gen</span><span class="o">]</span>
</span><span class='line'><span class="nb">name</span><span class="o">=</span><span class="mi">10</span><span class="n">gen</span> <span class="no">Repository</span>
</span><span class='line'><span class="n">baseurl</span><span class="o">=</span><span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">downloads</span><span class="o">-</span><span class="n">distro</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">redhat</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="n">i686</span>
</span><span class='line'><span class="n">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<h5>(4) 安装mongo-10gen和mongo-10-gen-server</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">yum</span> <span class="n">install</span> <span class="n">mongo</span><span class="o">-</span><span class="mi">10</span><span class="n">gen</span> <span class="n">mongo</span><span class="o">-</span><span class="mi">10</span><span class="n">gen</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>


<h5>(5) 设置mongoDB自动启动服务</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cp</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mongod</span> <span class="sr">/etc/</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mongod</span>
</span><span class='line'><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mongod</span> <span class="sr">/etc/</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">rc3</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="no">S25mongod</span> <span class="o">&amp;&amp;</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mongod</span> <span class="sr">/etc/</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">rc5</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="no">S25mongod</span>
</span><span class='line'><span class="n">chkconfig</span> <span class="err">—</span><span class="n">add</span> <span class="n">mongod</span>
</span></code></pre></td></tr></table></div></figure>


<h4>自动启动脚本</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/bin/bash</span>
</span><span class='line'><span class="c1"># mongod - Startup script for mongod</span>
</span><span class='line'><span class="c1"># chkconfig: 35 85 15</span>
</span><span class='line'><span class="c1"># description: Mongo is a scalable, document-oriented database.</span>
</span><span class='line'><span class="c1"># processname: mongod</span>
</span><span class='line'><span class="c1"># config: /etc/mongod.conf</span>
</span><span class='line'><span class="c1"># pidfile: /var/run/mongo/mongo.pid</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span> <span class="sr">/etc/</span><span class="n">rc</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">functions</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># things from mongod.conf get there by mongod reading it</span>
</span><span class='line'>
</span><span class='line'><span class="no">OPTIONS</span><span class="o">=</span><span class="s2">&quot; -f /etc/mongod.conf&quot;</span>
</span><span class='line'><span class="no">SYSCONFIG</span><span class="o">=</span><span class="s2">&quot;/etc/sysconfig/mongod&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">mongod</span><span class="o">=</span><span class="err">$</span><span class="p">{</span><span class="no">MONGOD</span><span class="o">-/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mongod</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="no">MONGO_USER</span><span class="o">=</span><span class="n">mongod</span>
</span><span class='line'><span class="no">MONGO_GROUP</span><span class="o">=</span><span class="n">mongod</span>
</span><span class='line'><span class="o">.</span> <span class="s2">&quot;$SYSCONFIG&quot;</span> <span class="o">||</span> <span class="kp">true</span>
</span><span class='line'><span class="n">start</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="vg">$&quot;</span><span class="no">Starting</span> <span class="n">mongod</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">  daemon —user &quot;</span><span class="vg">$MONGO_USER</span><span class="s2">&quot; $mongod $OPTIONS</span>
</span><span class='line'><span class="s2">  RETVAL=$?</span>
</span><span class='line'><span class="s2">  echo</span>
</span><span class='line'><span class="s2">  [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/mongod</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">stop()</span>
</span><span class='line'><span class="s2">{</span>
</span><span class='line'><span class="s2">  echo -n $&quot;</span><span class="no">Stopping</span> <span class="n">mongod</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">  killproc -p /var/lib/mongo/mongod.lock -t30 -TERM /usr/bin/mongod</span>
</span><span class='line'><span class="s2">  RETVAL=$?</span>
</span><span class='line'><span class="s2">  echo</span>
</span><span class='line'><span class="s2">  [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/mongod</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">restart () {</span>
</span><span class='line'><span class="s2">        stop</span>
</span><span class='line'><span class="s2">        start</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">ulimit -n 12000</span>
</span><span class='line'><span class="s2">RETVAL=0</span>
</span><span class='line'>
</span><span class='line'><span class="s2">case &quot;</span><span class="vg">$1</span><span class="s2">&quot; in</span>
</span><span class='line'><span class="s2">  start)</span>
</span><span class='line'><span class="s2">    start</span>
</span><span class='line'><span class="s2">    ;;</span>
</span><span class='line'><span class="s2">  stop)</span>
</span><span class='line'><span class="s2">    stop</span>
</span><span class='line'><span class="s2">    ;;</span>
</span><span class='line'><span class="s2">  restart|reload|force-reload)</span>
</span><span class='line'><span class="s2">    restart</span>
</span><span class='line'><span class="s2">    ;;</span>
</span><span class='line'><span class="s2">  condrestart)</span>
</span><span class='line'><span class="s2">    [ -f /var/lock/subsys/mongod ] &amp;&amp; restart || :</span>
</span><span class='line'><span class="s2">    ;;</span>
</span><span class='line'><span class="s2">  status)</span>
</span><span class='line'><span class="s2">    status $mongod</span>
</span><span class='line'><span class="s2">    RETVAL=$?</span>
</span><span class='line'><span class="s2">    ;;</span>
</span><span class='line'><span class="s2">  *)</span>
</span><span class='line'><span class="s2">    echo &quot;</span><span class="no">Usage</span><span class="p">:</span> <span class="vg">$0</span> <span class="p">{</span><span class="n">start</span><span class="o">|</span><span class="n">stop</span><span class="o">|</span><span class="n">status</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">reload</span><span class="o">|</span><span class="n">force</span><span class="o">-</span><span class="n">reload</span><span class="o">|</span><span class="n">condrestart</span><span class="p">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">    RETVAL=1</span>
</span><span class='line'><span class="s2">esac</span>
</span><span class='line'>
</span><span class='line'><span class="s2">exit $RETVAL</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[REST，资源和Rails]]></title>
    <link href="http://khua.github.com/blog/2012/09/09/rest%2Czi-yuan-he-rails/"/>
    <updated>2012-09-09T14:01:00+08:00</updated>
    <id>http://khua.github.com/blog/2012/09/09/rest,zi-yuan-he-rails</id>
    <content type="html"><![CDATA[<p>具备表象状态迁移(Representational State Transfer, REST)或称为表象化状态迁移。它代表了分布式超媒体系统的体系结构风格，该风格中是Roy Fielding在论文中定义。REST在系统中加入一系列的限制，为确保极大的可扩展性。虽然REST定义了大量的重要体系结构限制(例如将用户接口和服务器实现的清晰分离、无状态、以及缓存能力)。REST关键的特有能力是统一接口的要求。REST接口是由HTTP接口定义的，支持GET/POST/PUT/DELETE。这种统一接口限制，跟面向服务的体系结构(Service-Oriented Architecture, SOA)相反，后者为每种类型的服务定义了不同的接口。</p>

<p>REST构架风格具有以下设计准则：</p>

<ul>
<li>网络上的所有事物都抽象为资源(resources = data + representation)</li>
<li>每个资源都对应一个唯一的资源标识(resources identifier = url)</li>
<li>通过连接器(generic connector interface)对资源进行操作(generic connector = HTTP Protocol 即GET/POST/PUT/DELETE)
＊ 对资源的各种操作不会改变资源标识(对资源的GET操作不改变资源的状态)</li>
<li>所有操作都是无状态的(stateless)</li>
</ul>


<!--more-->


<p>从Rails 1.2开始，Rails引入了完全REST化的API支持。路由(routes)实现了资源(resources)的概念，而representation(表象)则由respond_to方法实现。RESTful带给Rails最大的好处是：它帮助我们用一种比较标准化的方式来命名和组织Controllers和Actions。在没有RESTful之前，典型路由的设计是逐一指定Controller和Action。</p>

<p>将RESTful带入Rails路由系统的构思，出自它对应了HTTP动词# POST/GET/PUT/DELETE到数据的新增、读取、更新、删除等四项操作。原来的路由：</p>

<p><code>HTTP method：在HTTP1.1通信协义中定义了九种单词，分别是：HEAD/GET/POST/PUT/DELETE/TRACE/OPTIONS/CONNECT/PATCH</code></p>

<ul>
<li>/topics/create</li>
<li>/topics/show/id</li>
<li>/topics/update/id</li>
<li>/topics/destroy/id</li>
</ul>


<p>将会变成：</p>

<ul>
<li>POST /topics 对应到Controller中的creat action</li>
<li>GET /topics/id 对应到Controller中的show action</li>
<li>PUT /topics/id 对应到Controller中的update action</li>
<li>DELETE /topics/id 对应到Controller中的destroy action</li>
</ul>


<p>因此，Rails的路由设定很大程度上简化，只须在config/routes.rb中加入下行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resources :topics</span></code></pre></td></tr></table></div></figure>


<p>如此，会自动创建4个命名路由(named routes)，搭配四个HTTP动词，对应在到七个Actions，它的实际作用，就如同以下的设定：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>get  '/topics'       =&gt; "topics#index",   :as =&gt; "topics"
</span><span class='line'>post  '/topics'       =&gt; "topics#create",  :as =&gt; "topics"
</span><span class='line'>get   '/topics/:id'   =&gt; "topics#show",    :as =&gt; "topic"
</span><span class='line'>put   '/topics/:id'   =&gt; "topics#update",  :as =&gt; "topic"
</span><span class='line'>delete    '/topics/:id'   =&gt; "topics#destroy",:as =&gt; "topic"
</span><span class='line'>get   '/topics/:id'   =&gt; "topics#new", :as =&gt; "new_topic"
</span><span class='line'>get   '/topics/:id/edit'  =&gt; "topics#edit",    :as =&gt; "edit_topic"</span></code></pre></td></tr></table></div></figure>


<p>可以参考下表：</p>

<table>
<tr>
<td>Helper</td>
<td>GET</td>
<td>POST</td>
<td>PUT</td>
<td>DELETE</td>
</tr>
<tr>
<td>topic_path(@topic)</td>
<td>/topics/id<br>topics#show</td>
<td></td>
<td>/topics/id<br>topics#update</td>
<td>/topics/id<br>topics#destroy</td>
</tr>
<tr>
<td>topics_path</td>
<td>/topics<br>topics#index</td>
<td>/topics<br>topics#create</td>
<td></td>
<td></td>
</tr>
<tr>
<td>edit_topic_path(@topic)</td>
<td>/topics/id/edit<br>topics#edit</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>new_topic_path</td>
<td>/topics/new<br>topics#new</td>
<td></td>
<td></td>
<td></td>
</tr>
</table>


<p>注意，这七个Action方法的名字是Rails约定好的，无法修改。因此，链接可以写成：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>link_to topic.name, topic_path(@topic)</span></code></pre></td></tr></table></div></figure>


<p>而不是写成：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>link_to topic.name, :controller =&gt; 'topics', :action =&gt; :show, :id =&gt; topic.id</span></code></pre></td></tr></table></div></figure>


<p>因此，只需记得资源(resources)，就可以写成URL Helper:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[custom route_]topic[s]_path(@topic), :method =&gt; GET | POST | PUT | DELETE</span></code></pre></td></tr></table></div></figure>


<p>注意，<em>path结尾对应相对网址，而</em>url结尾对应完整的网址(包含域名)。</p>

<p>本文参考：<a href="http://ihower.tw/rails3/restful.html">RESTful应用程式，Ruby on Rails实战圣经，iHower</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何建立自己的Rubygems]]></title>
    <link href="http://khua.github.com/blog/2012/09/09/ru-he-jian-li-zi-ji-de-rubygems/"/>
    <updated>2012-09-09T12:50:00+08:00</updated>
    <id>http://khua.github.com/blog/2012/09/09/ru-he-jian-li-zi-ji-de-rubygems</id>
    <content type="html"><![CDATA[<h3>简单的示例：</h3>

<p>以创建topico-0.0.1.gem为例：</p>

<h4>建立文件夹</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.
</span><span class='line'>├── lib
</span><span class='line'>│   └── topico.rb
</span><span class='line'>└── topico.gemspec</span></code></pre></td></tr></table></div></figure>


<p>注意：lib目录下必须有个和你gem名字一样的rb文件。</p>

<!--more-->


<h4>编写代码 <code>lib\topico.rb</code></h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Topico</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">hello</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Hello, RubyGems!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>编辑GemSpec文件 <code>topico.gemspec</code></h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">name</span>        <span class="o">=</span> <span class="s1">&#39;topico&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">version</span>     <span class="o">=</span> <span class="s1">&#39;0.0.1&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">date</span>        <span class="o">=</span> <span class="s1">&#39;2012-03-11&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">summary</span>     <span class="o">=</span> <span class="s1">&#39;Greeting from Topico&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Topico shows a greeting to RubyGems&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">authors</span>     <span class="o">=</span> <span class="s1">&#39;Author Name&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">email</span>       <span class="o">=</span> <span class="s1">&#39;username@username.com&#39;</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">files</span>       <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;lib/topico.rb&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">homepage</span>    <span class="o">=</span> <span class="s1">&#39;http://rubygems.org/gems/topico&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里仅列出了较为常见的属性。</p>

<h4>编译生成gem</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">gem</span> <span class="n">build</span> <span class="n">topico</span><span class="o">.</span><span class="n">gemspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>系统会提示信息：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="no">Successfully</span> <span class="n">built</span> <span class="no">RubyGem</span>
</span><span class='line'>  <span class="no">Name</span><span class="p">:</span> <span class="n">topico</span>
</span><span class='line'>  <span class="no">Version</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>  <span class="no">File</span><span class="p">:</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span></code></pre></td></tr></table></div></figure>


<p>编译后可以查看文件夹结构 <code>tree</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span>
</span><span class='line'><span class="err">├──</span> <span class="n">lib</span>
</span><span class='line'><span class="err">│</span>   <span class="err">└──</span> <span class="n">topico</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">├──</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span><span class='line'><span class="err">└──</span> <span class="n">topico</span><span class="o">.</span><span class="n">gemspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意新生成的<code>topico-0.0.1.gem</code></p>

<h4>安装并测试gem</h4>

<p>安装topico-0.0.1.gem</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">gem</span> <span class="n">install</span> <span class="o">.</span><span class="n">/topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span></code></pre></td></tr></table></div></figure>


<p>系统会提示：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Successfully</span> <span class="n">installed</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'><span class="mi">1</span> <span class="n">gem</span> <span class="n">installed</span>
</span><span class='line'><span class="no">Installing</span> <span class="n">ri</span> <span class="n">documentation</span> <span class="k">for</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="no">Installing</span> <span class="no">RDoc</span> <span class="n">documentation</span> <span class="k">for</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>在irb中测试使用 <code>irb</code>：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;topico&#39;</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Topico</span><span class="o">.</span><span class="n">hello</span>
</span><span class='line'><span class="no">Hello</span><span class="p">,</span> <span class="no">RubyGems</span><span class="o">!</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>


<h4>发布到RugyGems网站</h4>

<p>先设置RubyGems的用户名和密码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">username</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">api_key</span><span class="o">.</span><span class="n">yaml</span> <span class="o">&gt;</span> <span class="o">~</span><span class="sr">/.gem/</span><span class="n">credentials</span>
</span><span class='line'><span class="no">Enter</span> <span class="n">host</span> <span class="n">password</span> <span class="k">for</span> <span class="n">user</span> <span class="s1">&#39;username&#39;</span><span class="p">:</span>
</span><span class='line'>  <span class="o">%</span> <span class="no">Total</span>    <span class="o">%</span> <span class="no">Received</span> <span class="o">%</span> <span class="no">Xferd</span>  <span class="no">Average</span> <span class="no">Speed</span>   <span class="no">Time</span>    <span class="no">Time</span>     <span class="no">Time</span>  <span class="no">Current</span>
</span><span class='line'>                                 <span class="no">Dload</span>  <span class="no">Upload</span>   <span class="no">Total</span>   <span class="no">Spent</span>    <span class="no">Left</span>  <span class="no">Speed</span>
</span><span class='line'>  <span class="mi">0</span>    <span class="mi">56</span>    <span class="mi">0</span>    <span class="mi">56</span>    <span class="mi">0</span>     <span class="mi">0</span>     <span class="mi">25</span>      <span class="mi">0</span> <span class="o">--</span><span class="ss">:-</span><span class="o">-</span><span class="ss">:-</span><span class="o">-</span>  <span class="mi">0</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">02</span> <span class="o">--</span><span class="ss">:-</span><span class="o">-</span><span class="ss">:-</span><span class="o">-</span>   <span class="mi">144</span>
</span></code></pre></td></tr></table></div></figure>


<p>设置成功后发布：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">gem</span> <span class="n">push</span> <span class="n">topico</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span><span class='line'><span class="no">Pushing</span> <span class="n">gem</span> <span class="n">to</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="no">Successfully</span> <span class="n">registered</span> <span class="n">gem</span><span class="p">:</span> <span class="n">topico</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>发布成功，这样大家都可以使用你的Rubygem啦。</p>

<h3>稍微复杂一些的示例</h3>

<p>下面看一下如何组织多个ruby文件。</p>

<h4>目录结构</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span>
</span><span class='line'><span class="err">├──</span> <span class="n">lib</span>
</span><span class='line'><span class="err">│</span>   <span class="err">├──</span> <span class="n">ext</span>
</span><span class='line'><span class="err">│</span>   <span class="err">│</span>   <span class="err">└──</span> <span class="n">calculation</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">│</span>   <span class="err">└──</span> <span class="n">topico</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">└──</span> <span class="n">topico</span><span class="o">.</span><span class="n">gemspec</span>
</span></code></pre></td></tr></table></div></figure>


<h4>编写GemSpec</h4>

<p>在<code>s.files</code>一行，修改：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">files</span>       <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;lib/topico.rb&quot;</span><span class="p">,</span> <span class="s2">&quot;lib/ext/calculation.rb&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>重新gem build即可。</p>

<h3>如何在Gem中包含可执行该件</h3>

<h4>在插件目录下，建立bin文件夹：</h4>

<p>生成可执行该件，并且将权限修改为可运行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">mkdir</span> <span class="n">bin</span>
</span><span class='line'><span class="err">$</span> <span class="n">touch</span> <span class="n">bin</span><span class="o">/</span><span class="n">greeting</span>
</span><span class='line'><span class="err">$</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="n">bin</span><span class="o">/</span><span class="n">greeting</span>
</span></code></pre></td></tr></table></div></figure>


<h4>修改可执行文件内容</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;topico&#39;</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">Topico</span><span class="o">.</span><span class="n">hello</span>
</span></code></pre></td></tr></table></div></figure>


<h4>修改GemSpec,添加一行<code>s.executables</code></h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">executables</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;greeting&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>本文参考：<a href="http://blog.csdn.net/kucss/article/details/7163563">如何创建自己的Ruby Gem包</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[熟练使用RubyGems]]></title>
    <link href="http://khua.github.com/blog/2012/09/09/shou-lian-shi-yong-rubygems/"/>
    <updated>2012-09-09T10:42:00+08:00</updated>
    <id>http://khua.github.com/blog/2012/09/09/shou-lian-shi-yong-rubygems</id>
    <content type="html"><![CDATA[<p>RubyGems是Ruby的插件管理系统，可以轻松安装及管理Ruby函式库。可以在RubyGems上找到所有开源套件，另外，如果想找到Ruby或Rails有哪些好用的插件，也可以浏览看看<a href="https://www.ruby-toolbox.com/">The Ruby Toolbox</a>，会按照插件的热门程度排序。</p>

<h3>常见指令</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem -v 查看RubyGems的版本
</span><span class='line'>gem update --system 升级RubyGems的版本
</span><span class='line'>gem install gem_name 安装某个插件
</span><span class='line'>gem install -v x.x.x gem_name 安装指定版本的插件
</span><span class='line'>gem list 列出安装的套件
</span><span class='line'>gem update gem_name 更新某个插件
</span><span class='line'>gem update 更新所有的插件
</span><span class='line'>gem uninstall gem_name 删除某个插件</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p>另外，在安装插件时，系统会默认安装该插件的RDoc和ri文件，如果不希望安装这些该件，可在安装时使用<code>--no-ri --no-rdoc</code>参数：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install gem_name --no-ri --no-rdoc
</span></code></pre></td></tr></table></div></figure>


<p>也可以在用户目录<code>~</code>下，新建一个<code>.gemrc</code>文档，内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem: --no-ri --no-rdoc</span></code></pre></td></tr></table></div></figure>


<p>系统将默认不安装RDoc和ri文件。</p>

<h3>国内RubyGems镜像</h3>

<p>如果服务器在国内，安装所需的gems将是异常痛苦的体验，所幸的是，现在可以使用淘宝的镜像：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem sources --remove https://rubygems.org/
</span><span class='line'>$ gem sources -a http://ruby.taobao.org/
</span><span class='line'>$ gem sources -l</span></code></pre></td></tr></table></div></figure>


<p>如果显示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*** CURRENT SOURCES ***
</span><span class='line'>
</span><span class='line'>http://ruby.taobao.org</span></code></pre></td></tr></table></div></figure>


<p>就说明更改成功啦，你现在可以从国内镜像安装rugy gems啦。详细内容可参考 <a href="ruby.taobao.org">Rubygems镜像</a></p>

<p>如果使用<code>Bundler</code>管理Ruby Gems，可以修改Gemfile：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source 'http://ruby.taobao.org/'
</span><span class='line'>
</span><span class='line'>gem 'rails', '3.2.2'
</span><span class='line'>... ... ...</span></code></pre></td></tr></table></div></figure>


<h3>建立和分享Ruby Gems</h3>

<p>根据官方的简介：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem update --system #Update to the latest RubyGems version
</span><span class='line'>gem build foo.gemspec #Build your gem
</span><span class='line'>gem push foo-1.0.0.gem #Deploy your gem instantly</span></code></pre></td></tr></table></div></figure>


<p>详请见后续文章：如何建立自己的Rubygem</p>

<h3>Top 50 Rubygems</h3>

<div><script src='https://gist.github.com/2015501.js?file='></script>
<noscript><pre><code>Count  Gem
7570    rack
7444    rake
7425    rails
7424    activesupport
7421    bundler
7412    actionpack
7410    actionmailer
7409    activerecord
7397    activeresource
7326    mime-types
7274    builder
6787    i18n
6547    rack-test
6527    tzinfo
6484    erubis
6447    treetop
6433    polyglot
6386    mail
6340    thor
6269    railties
6268    rack-mount
6266    activemodel
6261    arel
5958    abstract
5274    will_paginate
4935    newrelic_rpm
4597    nokogiri
4458    haml
4222    json
3703    bcrypt-ruby
3389    paperclip
3372    daemons
3335    warden
3330    devise
3224    aws-s3
2939    xml-simple
2931    hoptoad_notifier
2834    rest-client
2501    multi_json
2482    jquery-rails
2464    addressable
2392    fastercsv
2377    delayed_job
2343    oauth
2255    crack
2189    authlogic
2168    net-ssh
2161    pg
2090    orm_adapter
2036    rdoc</code></pre></noscript></div>

]]></content>
  </entry>
  
</feed>
